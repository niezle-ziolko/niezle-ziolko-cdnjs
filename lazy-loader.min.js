"use strict";module.exports=pixelmatch;const defaultOptions={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffColorAlt:null,diffMask:!1};function pixelmatch(e,a,i,n,l,f){if(!isPixelData(e)||!isPixelData(a)||i&&!isPixelData(i))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(e.length!==a.length||i&&i.length!==e.length)throw new Error("Image sizes do not match.");if(e.length!==n*l*4)throw new Error("Image data size does not match width/height.");f=Object.assign({},defaultOptions,f);var t=n*l,o=new Uint32Array(e.buffer,e.byteOffset,t),s=new Uint32Array(a.buffer,a.byteOffset,t);let d=!0;for(let r=0;r<t;r++)if(o[r]!==s[r]){d=!1;break}if(d){if(i&&!f.diffMask)for(let r=0;r<t;r++)drawGrayPixel(e,4*r,f.alpha,i);return 0}var h=35215*f.threshold*f.threshold;let u=0;for(let t=0;t<l;t++)for(let r=0;r<n;r++){var b=4*(t*n+r),c=colorDelta(e,a,b,b);Math.abs(c)>h?f.includeAA||!antialiased(e,r,t,n,l,a)&&!antialiased(a,r,t,n,l,e)?(i&&drawPixel(i,b,...c<0&&f.diffColorAlt||f.diffColor),u++):i&&!f.diffMask&&drawPixel(i,b,...f.aaColor):i&&!f.diffMask&&drawGrayPixel(e,b,f.alpha,i)}return u}function isPixelData(r){return ArrayBuffer.isView(r)&&1===r.constructor.BYTES_PER_ELEMENT}function antialiased(e,a,i,n,r,t){var l=Math.max(a-1,0),f=Math.max(i-1,0),o=Math.min(a+1,n-1),s=Math.min(i+1,r-1),d=4*(i*n+a);let h=a===l||a===o||i===f||i===s?1:0,u=0,b=0,c,g,x,y;for(let t=l;t<=o;t++)for(let r=f;r<=s;r++)if(t!==a||r!==i){var M=colorDelta(e,e,d,4*(r*n+t),!0);if(0===M){if(2<++h)return!1}else M<u?(u=M,c=t,g=r):M>b&&(b=M,x=t,y=r)}return 0!==u&&0!==b&&(hasManySiblings(e,c,g,n,r)&&hasManySiblings(t,c,g,n,r)||hasManySiblings(e,x,y,n,r)&&hasManySiblings(t,x,y,n,r))}function hasManySiblings(e,a,i,n,r){var l=Math.max(a-1,0),f=Math.max(i-1,0),o=Math.min(a+1,n-1),s=Math.min(i+1,r-1),d=4*(i*n+a);let h=a===l||a===o||i===f||i===s?1:0;for(let t=l;t<=o;t++)for(let r=f;r<=s;r++)if(t!==a||r!==i){var u=4*(r*n+t);if(e[d]===e[u]&&e[1+d]===e[1+u]&&e[2+d]===e[2+u]&&e[3+d]===e[3+u]&&h++,2<h)return!0}return!1}function colorDelta(r,t,e,a,i){let n=r[e+0],l=r[e+1],f=r[e+2];r=r[e+3];let o=t[a+0],s=t[a+1],d=t[a+2];e=t[a+3];if(r===e&&n===o&&l===s&&f===d)return 0;r<255&&(r/=255,n=blend(n,r),l=blend(l,r),f=blend(f,r)),e<255&&(e/=255,o=blend(o,e),s=blend(s,e),d=blend(d,e));t=rgb2y(n,l,f),a=rgb2y(o,s,d),r=t-a;if(i)return r;e=rgb2i(n,l,f)-rgb2i(o,s,d),i=rgb2q(n,l,f)-rgb2q(o,s,d),r=.5053*r*r+.299*e*e+.1957*i*i;return a<t?-r:r}function rgb2y(r,t,e){return.29889531*r+.58662247*t+.11448223*e}function rgb2i(r,t,e){return.59597799*r-.2741761*t-.32180189*e}function rgb2q(r,t,e){return.21147017*r-.52261711*t+.31114694*e}function blend(r,t){return 255+(r-255)*t}function drawPixel(r,t,e,a,i){r[t+0]=e,r[t+1]=a,r[t+2]=i,r[t+3]=255}function drawGrayPixel(r,t,e,a){e=blend(rgb2y(r[t+0],r[t+1],r[t+2]),e*r[t+3]/255);drawPixel(a,t,e,e,e)}
